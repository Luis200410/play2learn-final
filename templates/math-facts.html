{% extends "_base_vue.html" %}

{% block title %}Math Facts{% endblock %}
{% block main %}
  <h1>Math Facts</h1>
  <div class="mt-3">
    <ul class="nav nav-pills mb-3" id="mf-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="mf-leaderboard-tab" data-bs-toggle="pill" data-bs-target="#mf-leaderboard" type="button" role="tab">Leaderboard</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="mf-history-tab" data-bs-toggle="pill" data-bs-target="#mf-history" type="button" role="tab">My History</button>
      </li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane fade show active" id="mf-leaderboard" role="tabpanel">
        {% if leaderboard %}
        <div class="table-responsive">
          <table class="table table-sm table-striped align-middle">
            <thead>
              <tr><th>Rank</th><th>User</th><th>Finished</th><th>Settings</th><th>Score</th></tr>
            </thead>
            <tbody>
              {% for r in leaderboard %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>{% if r.user %}{{ r.user.username }}{% else %}Anonymous{% endif %}</td>
                <td>{{ r.finished_at|date:"Y-m-d H:i" }}</td>
                <td>{{ r.settings.operation }} up to {{ r.settings.max_number }}</td>
                <td><strong>{{ r.score }}</strong></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
          <p class="text-muted">No scores yet.</p>
        {% endif %}
      </div>
      <div class="tab-pane fade" id="mf-history" role="tabpanel">
        {% if request.user.is_authenticated %}
          {% if history %}
          <div class="table-responsive">
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr><th>Finished</th><th>Settings</th><th>Score</th></tr>
              </thead>
              <tbody>
                {% for r in history %}
                <tr>
                  <td>{{ r.finished_at|date:"Y-m-d H:i" }}</td>
                  <td>{{ r.settings.operation }} up to {{ r.settings.max_number }}</td>
                  <td><strong>{{ r.score }}</strong></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
            <p class="text-muted">You have no game history yet.</p>
          {% endif %}
        {% else %}
          <p><a href="{% url 'accounts:login' %}">Log in</a> to see your history.</p>
        {% endif %}
      </div>
    </div>
  </div>
  {{ block.super }}
{% endblock %}
